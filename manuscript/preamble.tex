% preamble.tex - LaTeX macros for quantum chemistry document

% Already included in some templates, but needed for arxiv.sty
% Including for more flexibility
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsfonts}

% Energy terms
\newcommand{\hamiltonianNuc}{H_0}
\newcommand{\nuc}{\text{nuc}}
\newcommand{\tot}{\text{tot}}
\newcommand{\ext}{\text{ext}}
\newcommand{\energyNuc}{E_{\nuc}}
\newcommand{\energyTot}{E_{\tot}}

% Position
\newcommand{\position}{\vect{r}}

% Potentials and chemical potentials
\newcommand{\imposedPotential}{V_\ext} % Potential applied to system
\newcommand{\imposedPotentialValue}{\imposedPotential(\position)} % Evaluated at a point
% How to notate the electrical potential, which is the negative of the potential
\newcommand{\electricalPotential}{v_\ext}
\newcommand{\electricalPotentialValue}[1]{\electricalPotential(\position)}

% Electron density and related
\newcommand{\electronDensity}{\rho} % Electron density
\newcommand{\electronDensityValue}{\electronDensity(\position)} % Evaluated

% Population and charge changes
\newcommand{\popChange}[1]{dN_{#1}}  % Change in electron population
\newcommand{\popChangeFixed}[1]{dN^0_{#1}}  % Change with fixed weight function
\newcommand{\chargeChange}[1]{dq_{#1}}  % Change in atomic charge
\newcommand{\chargeChangeFixed}[1]{dq^0_{#1}}  % Change with fixed weight function
\newcommand{\correctionFactorCharge}[1]{\frac{dq^0_{#1}}{dq_{#1}}}  % Correction factor for charge changes
\newcommand{\correctionFactorPop}[1]{\frac{dN^0_{#1}}{dN_{#1}}}  % Correction factor expressed with population changes

% Derivatives and operators
\newcommand{\funcDeriv}[2]{\frac{\delta #1}{\delta #2}}  % Functional derivative
\newcommand{\funcDerivValue}[2]{\frac{\delta #1}{\delta #2(\position)}}  % Functional derivative evaluated
\newcommand{\partDeriv}[2]{\frac{\partial #1}{\partial #2}}  % Partial derivative 
\newcommand{\constDeriv}[3]{\left(\frac{\partial #1}{\partial #2}\right)_{#3}}  % Constrained derivative

% Mathematical operations
\newcommand{\spaceIntegral}[1]{\int #1 \, d\position}  % Integration over space

% Vectors for systems of atoms
\newcommand{\vect}[1]{\mathbf{#1}}  % Vector notation, easily changeable

% \rho-weighted "average" (angle-bracket) and its explicit integral form
\newcommand{\densityAverage}[1]{\left\langle #1 \right\rangle}                 % \langle \cdot \rangle
\newcommand{\densityAverageDef}[1]{\spaceIntegral{ #1 \, \electronDensityValue }} % \int (\cdot)\,\rho(r)\,dr

\newcommand{\weightFunc}[2]{w_{#1}(\position;#2)}

% Derivatives of weight functions w.r.t. atomic populations
\newcommand{\weightDeriv}[2]{\partDeriv{w_{#1}}{N_{#2}}}           % \partial w_k / \partial N_j
\newcommand{\weightDerivValue}[2]{\weightDeriv{#1}{#2}(\position)} % \partial w_k/\partial N_j evaluated at r

% Shorthand for the \rho-weighted average of a weight-function derivative
\newcommand{\avgWeightDeriv}[2]{\densityAverage{\weightDeriv{#1}{#2}}}         % \langle \partial w_k / \partial N_j \rangle

\newcommand{\weightDerivSubscript}[3]{\left(\weightDeriv{#1}{#2}\right)_{#3}(\position)} % (\partial w_k / \partial N1)_{N2}

\newcommand{\avgWeightDerivSubscript}[3]{\left\langle \left( \weightDeriv{#1}{#2} \right)_{#3} \right\rangle}

% Reset counters and switch to S-prefixed numbering for supplementary material
% https://stackoverflow.com/questions/50223141/rmarkdown-bookdown-separate-figure-numbering-for-supplemental-section
\newcommand{\beginsupplement}{
  % --- sections ---
  \setcounter{section}{0}
  \renewcommand{\thesection}{S\arabic{section}}
  % keep subsections as S1.1, S1.2, ...
  \renewcommand{\thesubsection}{S\arabic{section}.\arabic{subsection}}
  \renewcommand{\thesubsubsection}{S\arabic{section}.\arabic{subsection}.\arabic{subsubsection}}
  % avoid duplicate PDF destinations with hyperref
  \renewcommand{\theHsection}{S\arabic{section}}
  \renewcommand{\theHsubsection}{S\arabic{section}.\arabic{subsection}}
  \renewcommand{\theHsubsubsection}{S\arabic{section}.\arabic{subsection}.\arabic{subsubsection}}
  % --- figures / tables / equations
  \setcounter{figure}{0}
  \renewcommand{\thefigure}{S\arabic{figure}}
  \setcounter{table}{0}
  \renewcommand{\thetable}{S\arabic{table}}
  \setcounter{equation}{0}
  \renewcommand{\theequation}{S\arabic{equation}}
}
