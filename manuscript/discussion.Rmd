# Discussion

We have, for the first time, trained a charge prediction model by minimizing error in the $\chi$-prediction task.
We created a training dataset of binary materials, and for each material, sampled a continuum of charge states ("frames") by imposing an external potential.
We computed $\Delta \chi$ for each frame, using a relationship with the strength of the imposed potential.
Then, we trained a QEq model using least squares linear regression.
In the linear regression framing, the independent variables were computed from the atomic partial charges, and the dependent variable was $\Delta \chi$.
Once the QEq model was trained in this $\chi$-prediction task, we used it for the $q$-prediction task by equalizing electronegativity.
Since classical QEq is one of the simplest empirical models of charge, it is satisfying that in the $\chi$-prediction problem it corresponds to training a linear model, the most basic model in machine learning.

An intuitive picture of the meaning of our calculation of $\Delta \chi$ is provided by considering the final frame in each series, in which the charges of both atoms are zero.
The atoms are being held in the neutral state by the electric field.
The electronegativity difference $\Delta \chi^0$ is being measured by the strength of the field required to prevent charge transfer.

In the course of our demonstration of training with $\chi$-prediction, three main technical challenges emerged, but were ultimately solvable.
The most important is that the shape of the field has to be matched to the shape of the weight functions used to define the partial charge.
Another complication is that the relationship between $\chi_k$ and the imposed potential $\lambda_k$ involves the system electronegativity $\chi$.
For the binary systems, we handled this by taking the difference $\Delta \chi$, which subtracts off $\chi$, and for the $n$-atom case we derived a more general solution.
There was an additional complication because we used a variant of Hirshfeld-I charges, in which the boundary between atoms depends on their charges.
This was solved by computing a correction for the boundary response, which to our knowledge has not yet appeared in the literature.
In our case the correction could be easily computed with an integral against the density, but it would be more difficult to compute for more flexible partial charge definitions like Bader charges [@baderbook] or MBIS [@mbis].

## Conclusions

The current generation of MLIP training datasets includes off-equilibrium geometries and associated forces, and sometimes atomic charges $q_k$.
We have shown that when constructing the next generation, it is feasible to include off-equilibrium electron densities, and associated electronegativities $\chi_k$, which are the derivatives of the energy with respect to the charges.
Constructing such a dataset is straightforward with appropriately shaped potentials, or with existing constrained DFT implementations.

Off-equilibrium electron densities are valuable on on their own for providing information about polarizability.
One issue this raises is that the shaped potentials required for $\chi_k$ computation are of a different form than the potentials that would be encountered in applications such as QM/MM.
This issue could be addressed with richer atomic density descriptors than charge, including atomic polarization or higher moments.

The most direct value of annotating data with $\chi_k$ is to train QEq models, which could be useful for fourth-generation MLIPs.
However, thinking beyond MLIPs, $\chi_k$ may also be a useful training target for models of electronic structure.
For electronic structure, the $\chi$-prediction problem is to map electron density to the parameters $\lambda_k$ of the potential, which can be in principle be done exactly [@hohenbergKohn].
