# Discussion

We have, for the first time, trained a QEq model by minimizing error in the $\chi$-prediction task.
The model trained is the classical QEq model in which the parameters are $\chi^0_e$ and $\eta_e$ for each element $e$.
These parameters were determined with standard least-squares linear regression, far simpler than the optimization procedures used previously to train the classical QEq model in the $q$-prediction task [@verstraelenElectronegativityParameters].
Since classical QEq is one of the simplest empirical models of charge, it is satisfying that in the $\chi$-prediction problem it corresponds to training a linear model, the most basic model in machine learning.

The framing of QEq training as linear regression is related to the physical hypothesis that electronegativity $\chi$ depends linearly on the charges $q$.
However, the reason that training the classical QEq model with linear regression was possible in the $\chi$-prediction problem is not because electronegativities depend linearly on the charges, but because they depend linearly on the parameters, $\chi^0_e$ and $\eta_e$, as shown in formula \eqref{eq:LinearModel}.
This mode of training is not possible in the $q$-prediction problem, because although equilibrium charges depend linearly on the electronegativity parameters $\chi^0_e$, the weights are a non-linear function of the hardnesses of both atoms, as shown in formula \eqref{eq:EEqPred}.

To train in the $\chi$-prediction task, we created a dataset of binary materials annotated with $\Delta \chi$ by imposing an external electric field and determining $\Delta \chi$ through a relation with the strength of the electric field.
An intuitive picture of the meaning of this calculation is provided by considering the final frame in each series, in which the charges of both atoms are zero.
The atoms are being held in the neutral state by the electric field.
The electronegativity difference $\Delta \chi^0$ is being measured according to the strength of the field required to prevent charge transfer.
This intuitive picture is complicated by the fact that it is not sufficient to use a uniform electric field, but rather the shape of the field must correspond to the weight functions in the charge definition.
Another approach to constructing the dataset would have been constrained DFT, which can be interpreted as solving for the strength of the potential that achieves given charges.
Either approach works, though applying potentials is easier to implement.

Another complication was that the electronegativity difference is also not directly equal to the strength of the field, since it must be adjusted for the change in boundaries between the atoms.
This correction can be done numerically in any dataset like ours with a continuous series of charges, just as a force can be calculated numerically in a continuous series of stretched bonds.
Analogous to the analytical computation of Feynman-Hellmann forces [@FeynmanForcesInMolecules], we also computed these corrections and thus electronegativities from individual frames, but this required an analytic derivative of the weight function.
Though this was available in the Hirshfeld-I case, computing $\chi$ with other partial charge methods, such as Bader charges or MBIS, will require further work to analytically differentiate the weight functions.

Besides the linear model, more sophisticated predictive models from machine learning can be trained using atomic electronegativities like the one demonstrated here.
One generalization is the one already made, in which $\chi^0$ and $\eta$ parameters depend on the environment.
The need for environment dependence of $\chi^0$ can be seen in our dataset, since in the leave-one-out analysis $\Delta \chi^0$ in a given structure was not perfectly predictable from the rest of the dataset (Figure \@ref(fig:linear-model-figure)A).

Our framing of QEq models as linear $\chi$-prediction models also raises the suggestion of using more sophisticated and flexible $\chi$-prediction models.
The advantage of going beyond linear models is supported by the observation that the $\Delta \chi(q_A)$ trends were not perfectly linear (Figure \@ref(fig:linear-model-figure)A).
However, the deviations from linearity were small, and the downside of a nonlinear model would be that electronegativity equalization could no longer be accomplished simply by solving a linear system, and iterating to a solution would add computational time.

The current generation of machine learning datasets includes atomic partial charges, as well as non-equilibrium geometries and forces [@isayevani2].
The current generation of machine learning models includes QEq, currently trained by minimizing the error of the equalized charges, rather than by minimizing the predictions of electronegativity used to obtain them.
Our demonstration opens up the possibility of training these models instead using atomic $\chi$ values, using datasets that include electron densities perturbed by fields.
